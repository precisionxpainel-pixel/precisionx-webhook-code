// api/cakto-webhook.js

export default async function handler(req, res) {
  // Aceita s√≥ POST da Cakto para processar compra
  if (req.method === "POST") {
    // tenta ler o corpo
    const body = req.body || {};

    // s√≥ pra debug inicial
    console.log("üî• NOVO WEBHOOK CAKTO RECEBIDO:");
    console.log(JSON.stringify(body, null, 2));

    // resposta padr√£o pra Cakto
    return res.status(200).json({
      ok: true,
      message: "Webhook recebido pela Vercel.",
      event: body.event || null,
      emailDetectado: body?.data?.customer?.email || null
    });
  }

  // Qualquer GET (tipo voc√™ abrindo no navegador) s√≥ pra teste
  if (req.method === "GET") {
    return res.status(200).json({
      ok: true,
      note: "Endpoint ativo. Use POST aqui com o webhook da Cakto."
    });
  }

  // Outros m√©todos (PUT, DELETE etc.)
  return res.status(405).json({
    ok: false,
    error: "M√©todo n√£o permitido"
  });
}
